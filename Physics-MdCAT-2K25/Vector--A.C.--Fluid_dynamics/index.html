<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MCQ Test Platform</title>
    <link rel="stylesheet" href="style.css" />
    <script>
      if (sessionStorage.getItem("unlocked") !== "true") {
        window.location.href = "../../index.html"; // goes up two folders
      }
    </script>
  </head>
  <body>
    <div class="app-container">
      <header class="top-bar">
        <a
          href="https://gondal-official.github.io/Bio-MDCAT/"
          target="_blank"
          rel="noopener noreferrer"
          id="home-btn"
          class="nav-btn"
        >
          HOME
        </a>

        <button id="calc-btn" class="nav-btn">CALCULATOR</button>
      </header>
      <!-- Setup Screen -->
      <div id="setup-screen" class="screen active">
        <div class="card">
          <h1>Start Test</h1>
          <p id="total-questions-info">
            Total questions available: <strong>-</strong>
          </p>
          <div class="form-group">
            <label for="num-questions-input"
              >Number of questions to attempt:</label
            >
            <input
              type="number"
              id="num-questions-input"
              min="1"
              placeholder="e.g., 10"
            />
            <div id="num-error" class="error-message"></div>
          </div>
          <button id="start-test-btn" class="btn btn-primary">
            Start Test
          </button>
        </div>
      </div>

      <!-- Test Screen -->
      <div id="test-screen" class="screen">
        <div class="test-header">
          <span id="question-counter" aria-live="polite"></span>
          <span id="timer" aria-live="assertive"></span>
        </div>
        <div
          class="progress-bar-container"
          role="progressbar"
          aria-valuenow="0"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          <div id="progress-bar"></div>
        </div>
        <div class="card question-card">
          <p id="question-text"></p>
          <ul id="options-list" role="listbox"></ul>
        </div>
        <button id="next-btn" class="btn btn-primary hidden">Next</button>
      </div>

      <!-- Result Screen -->
      <div id="result-screen" class="screen">
        <div class="card">
          <h1>Test Results</h1>
          <div id="score-summary"></div>
          <div id="wrong-questions-container" class="hidden">
            <h2>Review Incorrect Answers</h2>
            <div id="wrong-questions-list"></div>
          </div>
          <div class="result-actions">
            <button id="retake-wrong-btn" class="btn btn-secondary hidden">
              Retake Wrong Questions Only
            </button>
            <button id="back-to-setup-btn" class="btn">New Test</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Calculator Popup -->
    <div id="calc-popup" class="calc-popup hidden">
      <div class="calc-container">
        <div class="calc-header">
          <span>Calculator</span>
          <button id="close-calc" class="close-btn">Ã—</button>
        </div>
        <iframe
          src="https://gondal-official.github.io/Calulator/"
          title="Calculator"
          class="calc-frame"
        ></iframe>
      </div>
    </div>

    <script>
      // --- TOUCH SCROLL FIX FOR CALCULATOR POPUP ---
      document.addEventListener(
        "touchmove",
        function (e) {
          const calcPopup = document.getElementById("calc-popup");
          const calcContainer = document.querySelector(".calc-container");

          if (calcPopup && !calcPopup.classList.contains("hidden")) {
            // Allow scroll *inside* calculator
            if (calcContainer && calcContainer.contains(e.target)) {
              return; // let it scroll
            }
            // Prevent background scroll
            e.preventDefault();
          }
        },
        { passive: false }
      );
    </script>

    <script src="script.js"></script>
  </body>
</html>
